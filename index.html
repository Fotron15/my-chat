<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Killer IDE: Python Edition</title>
<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
<style>
/* --- –ë–ê–ó–û–í–´–ô –î–ò–ó–ê–ô–ù --- */
body { font-family: 'Segoe UI', sans-serif; background:#1e1e2f; color:#eee; margin:0; padding:0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
* { box-sizing: border-box; outline: none; }

.navbar { background:#28293d; height: 50px; display: flex; align-items: center; padding: 0 15px; border-bottom: 1px solid #111; justify-content: space-between; flex-shrink: 0; }
.nav-controls { display: flex; gap: 8px; }

button { border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600; transition: 0.2s; }
.btn-primary { background: #007acc; color: white; }
.btn-success { background: #4caf50; color: white; }
.btn-warning { background: #ff9800; color: white; }
.btn-dark { background: #444; color: #ccc; }

#project-screen, #ide-screen { flex-grow: 1; display: none; }
#project-screen { flex-direction: column; align-items: center; padding: 40px; overflow-y: auto; }

.project-list { display: flex; gap: 20px; flex-wrap: wrap; margin-top: 30px; justify-content: center; }
.project-card { background: #2c2c3e; width: 160px; height: 130px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; border: 2px solid transparent; position: relative; }
.project-card:hover { border-color: #007acc; transform: translateY(-3px); }

.sidebar { width: 220px; background: #252526; border-right: 1px solid #000; display: flex; flex-direction: column; }
.sidebar-header { padding: 10px; background: #333340; display: flex; justify-content: space-between; align-items: center; font-size: 11px; font-weight: bold; }

.file-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; }
.file-item { padding: 8px 15px; cursor: pointer; font-size: 14px; color: #ccc; border-left: 3px solid transparent; }
.file-item.active { background: #37373d; color: #fff; border-left-color: #007acc; }

.editor-wrapper { flex-grow: 1; display: flex; flex-direction: column; background: #1e1e1e; position: relative; }
.code-container { display: flex; flex-grow: 1; overflow: hidden; }
.line-numbers { width: 40px; background: #1e1e1e; color: #6e7681; text-align: right; padding: 10px 5px; font-family: monospace; font-size: 14px; line-height: 21px; border-right: 1px solid #333; overflow: hidden; }
textarea#code-editor { flex-grow: 1; background: #1e1e1e; color: #d4d4d4; border: none; resize: none; padding: 10px; font-family: monospace; font-size: 14px; line-height: 21px; outline: none; }

/* –ö–û–ù–°–û–õ–¨ –î–õ–Ø PYTHON */
#console-output { height: 150px; background: #000; color: #0f0; padding: 10px; font-family: monospace; font-size: 13px; overflow-y: auto; display: none; border-top: 2px solid #444; }

/* –ú–û–î–ê–õ–ö–ò */
.modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; align-items:center; justify-content:center; z-index:1000; }
.modal { background:#252526; padding:20px; border-radius:8px; width:350px; border: 1px solid #444; }
.lib-item { display: flex; justify-content: space-between; align-items: center; background: #333; padding: 10px; border-radius: 5px; margin-top: 10px; }
</style>
</head>
<body>

<div class="navbar">
  <div style="font-weight:bold; color: #61dafb">‚ö° Killer IDE Pro</div>
  <div class="nav-controls" id="nav-controls-project" style="display:none;">
    <button class="btn-warning" onclick="openModal('libraries')">üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏</button>
    <button class="btn-success" onclick="runProject()">‚ñ∂ –ó–∞–ø—É—Å–∫</button>
    <button class="btn-primary" onclick="saveCurrentFile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="btn-dark" onclick="closeProject()">üö™ –í—ã—Ö–æ–¥</button>
  </div>
  <div class="nav-controls" id="nav-controls-home">
    <button class="btn-primary" onclick="openModal('create-project')">+ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
  </div>
</div>

<div id="project-screen" style="display:flex;">
  <h2>–í–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>
  <div class="project-list" id="project-list"></div>
</div>

<div id="ide-screen" style="display:none;">
  <div class="sidebar">
    <div class="sidebar-header"><span>–§–ê–ô–õ–´</span><button class="btn-primary" onclick="openModal('create-file')">+</button></div>
    <ul class="file-list" id="file-list"></ul>
  </div>
  <div class="editor-wrapper">
    <div class="code-container">
      <div id="line-numbers" class="line-numbers">1</div>
      <textarea id="code-editor" spellcheck="false" oninput="updateLineNumbers()"></textarea>
    </div>
    <div id="console-output"></div>
  </div>
</div>

<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal-content">
      </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('killer_ide_python')) || { projects: {} };
let currentProjectId = null;
let currentFileId = null;
let pyodide = null; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–≤–∏–∂–∫–∞ Python

const TEMPLATES = {
    html: '<!DOCTYPE html>\n<html>\n<body>\n  <h1>–ü—Ä–∏–≤–µ—Ç –∏–∑ HTML!</h1>\n</body>\n</html>',
    css: 'body { background: #1e1e2f; color: white; }',
    js: 'console.log("JS —Ä–∞–±–æ—Ç–∞–µ—Ç!");',
    py: 'print("–ü—Ä–∏–≤–µ—Ç –∏–∑ Python!")\n# –¢–≤–æ–π –∫–æ–¥ –∑–¥–µ—Å—å\nname = "Killer"\nprint(f"Hello, {name}!")'
};

/* --- –ó–ê–ü–£–°–ö PYTHON --- */
async function runPythonCode(code) {
    const consoleEl = document.getElementById('console-output');
    consoleEl.style.display = 'block';
    consoleEl.innerHTML = "<i>–ó–∞–≥—Ä—É–∑–∫–∞ Python...</i>\n";
    
    try {
        if (!pyodide) {
            pyodide = await loadPyodide();
        }
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º print() –≤ –Ω–∞—à—É –∫–æ–Ω—Å–æ–ª—å
        pyodide.runPython(`
            import sys
            import io
            sys.stdout = io.StringI()
        `);
        
        await pyodide.runPythonAsync(code);
        
        const stdout = pyodide.runPython("sys.stdout.getvalue()");
        consoleEl.innerText = stdout || "–ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω (–±–µ–∑ –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å)";
    } catch (err) {
        consoleEl.innerHTML = `<span style="color:red">–û—à–∏–±–∫–∞: ${err}</span>`;
    }
}

/* --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê --- */
function renderProjects() {
    const list = document.getElementById('project-list');
    list.innerHTML = '';
    for (let id in data.projects) {
        const card = document.createElement('div');
        card.className = 'project-card';
        card.innerHTML = `<span>üì¶</span><b>${data.projects[id].name}</b>`;
        card.onclick = () => openProject(id);
        list.appendChild(card);
    }
}

function openProject(id) {
    currentProjectId = id;
    document.getElementById('project-screen').style.display = 'none';
    document.getElementById('ide-screen').style.display = 'flex';
    document.getElementById('nav-controls-home').style.display = 'none';
    document.getElementById('nav-controls-project').style.display = 'flex';
    renderFileList();
    openFile(Object.keys(data.projects[id].files)[0]);
}

function closeProject() {
    saveCurrentFile();
    document.getElementById('project-screen').style.display = 'flex';
    document.getElementById('ide-screen').style.display = 'none';
    document.getElementById('nav-controls-home').style.display = 'flex';
    document.getElementById('nav-controls-project').style.display = 'none';
    document.getElementById('console-output').style.display = 'none';
    renderProjects();
}

function renderFileList() {
    const list = document.getElementById('file-list');
    list.innerHTML = '';
    const files = data.projects[currentProjectId].files;
    for (let f in files) {
        const li = document.createElement('li');
        li.className = `file-item ${currentFileId === f ? 'active' : ''}`;
        li.textContent = 'üìÑ ' + f;
        li.onclick = () => openFile(f);
        list.appendChild(li);
    }
}

function openFile(name) {
    saveCurrentFile();
    currentFileId = name;
    document.getElementById('code-editor').value = data.projects[currentProjectId].files[name] || '';
    document.getElementById('console-output').style.display = 'none';
    updateLineNumbers();
    renderFileList();
}

function saveCurrentFile() {
    if (currentProjectId && currentFileId) {
        data.projects[currentProjectId].files[currentFileId] = document.getElementById('code-editor').value;
        localStorage.setItem('killer_ide_python', JSON.stringify(data));
    }
}

function updateLineNumbers() {
    const lines = document.getElementById('code-editor').value.split('\n').length;
    document.getElementById('line-numbers').innerHTML = Array.from({length: lines}, (_, i) => i + 1).join('<br>');
}

function runProject() {
    saveCurrentFile();
    const code = document.getElementById('code-editor').value;
    if (currentFileId.endsWith('.py')) {
        runPythonCode(code);
    } else if (currentFileId.endsWith('.html')) {
        const blob = new Blob([code], {type: 'text/html'});
        window.open(URL.createObjectURL(blob), '_blank');
    } else {
        alert("–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª .html –∏–ª–∏ .py");
    }
}

/* --- –ú–û–î–ê–õ–ö–ò --- */
function openModal(type) {
    const overlay = document.getElementById('modal-overlay');
    const content = document.getElementById('modal-content');
    overlay.style.display = 'flex';

    if (type === 'create-project') {
        content.innerHTML = `<h3>–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h3><input type="text" id="m-in" placeholder="–ò–º—è..."><button class="btn-primary" onclick="createProject()">–°–æ–∑–¥–∞—Ç—å</button><button class="btn-dark" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>`;
    } else if (type === 'create-file') {
        const hasPython = data.projects[currentProjectId].pythonEnabled;
        content.innerHTML = `<h3>–ù–æ–≤—ã–π —Ñ–∞–π–ª</h3>
            <input type="text" id="m-in" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ...">
            <select id="m-type">
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="js">JS</option>
                ${hasPython ? '<option value="py">Python</option>' : ''}
            </select>
            <button class="btn-primary" onclick="createFile()">–î–æ–±–∞–≤–∏—Ç—å</button>
            <button class="btn-dark" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>`;
    } else if (type === 'libraries') {
        const isPyOn = data.projects[currentProjectId].pythonEnabled;
        content.innerHTML = `<h3>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏</h3>
            <div class="lib-item">
                <span>üêç Python (Pyodide)</span>
                <button class="${isPyOn ? 'btn-dark' : 'btn-success'}" onclick="toggleLib('python')">
                    ${isPyOn ? '–£–¥–∞–ª–∏—Ç—å' : '–°–∫–∞—á–∞—Ç—å'}
                </button>
            </div>
            <button class="btn-dark" style="margin-top:20px" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>`;
    }
}

function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

function createProject() {
    const name = document.getElementById('m-in').value;
    if (!name) return;
    const id = 'p' + Date.now();
    data.projects[id] = { name: name, files: { 'index.html': TEMPLATES.html }, pythonEnabled: false };
    localStorage.setItem('killer_ide_python', JSON.stringify(data));
    renderProjects();
    closeModal();
    openProject(id);
}

function createFile() {
    const name = document.getElementById('m-in').value;
    const type = document.getElementById('m-type').value;
    const full = name.endsWith('.' + type) ? name : name + '.' + type;
    data.projects[currentProjectId].files[full] = TEMPLATES[type] || '';
    localStorage.setItem('killer_ide_python', JSON.stringify(data));
    renderFileList();
    closeModal();
    openFile(full);
}

function toggleLib(lib) {
    if (lib === 'python') {
        data.projects[currentProjectId].pythonEnabled = !data.projects[currentProjectId].pythonEnabled;
        localStorage.setItem('killer_ide_python', JSON.stringify(data));
        alert(data.projects[currentProjectId].pythonEnabled ? "Python –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!" : "Python —É–¥–∞–ª–µ–Ω!");
        closeModal();
    }
}

renderProjects();
</script>
</body>
</html>
